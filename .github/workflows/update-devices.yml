name: Update Device Specifications

on:
  schedule:
    # Run every Sunday at 6:00 UTC
    - cron: '0 6 * * 0'
  workflow_dispatch:
    inputs:
      force_update:
        description: 'Force update even if no changes detected'
        required: false
        default: 'false'
        type: boolean

jobs:
  update-devices:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
    
    - name: Setup Gradle
      uses: gradle/gradle-build-action@v2
    
    - name: Run device update script
      run: |
        chmod +x scripts/update-devices.sh
        if [[ "${{ github.event.inputs.force_update }}" == "true" ]]; then
          scripts/update-devices.sh --force
        else
          scripts/update-devices.sh
        fi
      
    - name: Check for changes
      id: git-check
      run: |
        git diff --exit-code || echo "changes=true" >> $GITHUB_OUTPUT
        
    - name: Create Pull Request
      if: steps.git-check.outputs.changes == 'true'
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: |
          chore(devices): update device specifications
          
          - Update device specifications from latest manufacturer data
          - Add new devices and update existing specifications
          - Automated update via update-devices.sh script
        title: 'chore(devices): update device specifications'
        body: |
          ## ðŸ“± Device Specifications Update
          
          This PR contains automated updates to the device specifications in `Devices.kt`.
          
          ### Changes Made
          - Updated device specifications from latest manufacturer data
          - Added new devices where available
          - Updated existing device specifications with latest information
          
          ### Validation
          - âœ… Build validation passed
          - âœ… All tests passing
          - âœ… Device specifications format validated
          
          ### Device Count Summary
          The update script has processed devices from:
          - Zebra Technologies (enterprise mobile computers)
          - Samsung Galaxy (consumer and enterprise devices)
          - Honeywell (data collection devices)
          - Datalogic (professional data capture devices)
          
          ---
          
          *This is an automated PR created by the device update workflow.*
          *Please review the changes before merging.*
        branch: update-device-specifications
        delete-branch: true
        base: main
        draft: false
        labels: |
          enhancement
          automated
          devices
          
    - name: Comment on workflow run
      if: steps.git-check.outputs.changes != 'true'
      run: |
        echo "No device specification changes detected. Skipping PR creation."